<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Open in Wallet — IBITIcoin</title>
  <link href="css/style.css" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    :root{ --ib-gold:#f7d000; --ib-border:rgba(247,208,0,0.22); --ib-shadow:0 0 22px rgba(255,215,0,0.10); }
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:18px;
      background: radial-gradient(circle at 50% 0%, #151515 0%, #050505 50%, #000 100%);
      color:#eaeaea; font-family: Orbitron, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .box{
      width:min(560px,100%); border:1px solid var(--ib-border); border-radius:18px;
      background: rgba(0,0,0,0.45); box-shadow: var(--ib-shadow); padding:18px;
    }
    h2{ margin:0 0 8px; color:var(--ib-gold); text-align:center; text-shadow:0 0 16px rgba(247,208,0,0.25); }
    p{ margin:0 0 14px; color:rgba(255,255,255,0.78); font-size:13px; line-height:1.55; text-align:center; }
    .btn{
      width:100%; display:flex; align-items:center; justify-content:center; gap:10px;
      padding:14px; border-radius:12px; border:1px solid var(--ib-border);
      background: rgba(247,208,0,0.12); color:var(--ib-gold);
      cursor:pointer; font-weight:800; text-decoration:none; box-shadow: var(--ib-shadow);
      margin-top:10px; user-select:none;
    }
    .btn.secondary{ background: rgba(0,0,0,0.35); color:#fff; }
    .mono{
      margin-top:12px; padding:10px 12px; border-radius:12px;
      border:1px solid rgba(247,208,0,0.30); background: rgba(0,0,0,0.55);
      color:#fff; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px;
      word-break:break-all;
    }
    .row{ display:flex; gap:10px; margin-top:10px; }
    .row .btn{ margin-top:0; }
    .hint{ margin-top:12px; font-size:12px; color:rgba(255,255,255,0.65); line-height:1.5; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Open IBITI Shop in your wallet</h2>
    <p>Choose a wallet to open the shop in its built-in DApp browser.</p>

    <a id="mmLink" class="btn" href="#">Open in MetaMask</a>
    <a id="twLink" class="btn" href="#">Open in Trust Wallet</a>

    <div class="row">
      <button id="copyBtn" class="btn secondary" type="button">Copy shop link</button>
      <a id="openShop" class="btn secondary" href="#">Open in browser</a>
    </div>

    <div class="mono" id="shopUrl">—</div>

    <div class="hint">
      Binance Wallet: open Binance App → Web3 Wallet → DApps → paste the copied link.
    </div>
  </div>

<script>
(function () {
  // берём redirect из ?redirect=..., иначе берём текущий домен + /shop.html + query
  var p = new URLSearchParams(location.search);
  var redirect = p.get("redirect");

  var shopUrl;
  if (redirect) {
    shopUrl = redirect;
  } else {
    var u = new URL(location.href);
    u.pathname = "/shop.html";
    shopUrl = u.toString();
  }

  document.getElementById("shopUrl").textContent = shopUrl;
  document.getElementById("openShop").href = shopUrl;

  // MetaMask deeplink: ВАЖНО! нельзя оставлять ? и & неэнкоденными, иначе MetaMask теряет параметры.
  function mmSafeEncode(s){
    // encodeURIComponent всё кодит, но нам удобно вернуть "/" назад, чтобы путь читался нормально
    return encodeURIComponent(s).replace(/%2F/gi, "/");
  }

  var dappNoProto = shopUrl.replace(/^https?:\/\//i, "");
  document.getElementById("mmLink").href = "https://link.metamask.io/dapp/" + mmSafeEncode(dappNoProto);

  // Trust Wallet
  document.getElementById("twLink").href =
    "https://link.trustwallet.com/open_url?coin_id=60&url=" + encodeURIComponent(shopUrl);

  document.getElementById("copyBtn").addEventListener("click", async function () {
    try {
      await navigator.clipboard.writeText(shopUrl);
      alert("Copied:\n" + shopUrl);
    } catch (e) {
      var ta = document.createElement("textarea");
      ta.value = shopUrl;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      alert("Copied:\n" + shopUrl);
    }
  });
})();
</script>
</body>
</html>
