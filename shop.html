<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–∞–≥–∞–∑–∏–Ω IBITIcoin</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
  <style>
    .hero-header { padding: 15px 20px; text-align: center; }
    .hero-header h1 { font-size: 3em; color: gold; margin: 0; }
    .hero-header p { font-size: 1.5em; color: #fff; }
    #countdownNotice { text-align: center; font-weight: bold; color: gold; font-size: 1.2em; margin-bottom: 10px; }
    .wallet-section { text-align: center; margin: 20px auto; }
    .wallet-section button { background: gold; color: #000; border: none; padding: 12px 24px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: background .3s; }
    .wallet-section button:hover { background: #c0a000; }
    .wallet-section #walletAddress { margin-top: 10px; font-weight: bold; color: gold; }
    .wallet-section #ibitiBalance { color: gold; font-weight: bold; margin-top: 10px; }
    .shop-items { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; max-width: 1200px; margin: 40px auto; padding: 0 20px; }
    .shop-item { background: #111; border: 1px solid gold; border-radius: 10px; overflow: hidden; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,.5); transition: transform .3s; }
    .shop-item:hover { transform: scale(1.02); }
    .shop-item img { width: 100%; display: block; }
    .shop-item h3 { margin: 10px 0; color: gold; font-size: 1.3em; }
    .shop-item p { color: gold; margin: 0 10px 10px; }
    .shop-item button { background: gold; color: #000; border: none; padding: 10px; width: 100%; font-weight: bold; cursor: pointer; border-radius: 0 0 10px 10px; transition: background .3s; }
    .shop-item button:hover { background: #c0a000; }
    #walletModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,.6); justify-content: center; align-items: center; z-index: 3000; backdrop-filter: blur(2px); }
    #walletModal .ibiti-card { background:#111; padding:18px; border:1px solid gold; border-radius:10px; max-width:420px; width:92%; color:#ffd700; position:relative; }
    #walletModal .ibiti-close { position:absolute; top:8px; right:10px; background:transparent; border:0; color:#fff; font-size:18px; cursor:pointer; }
    .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background: rgba(0,0,0,.7); }
    .modal-content-custom { background:#111; margin:10% auto; padding:20px; border:2px solid gold; width:90%; max-width:500px; border-radius:10px; color:gold; text-align:center; position:relative; }
    .modal-content-custom .close { position:absolute; top:10px; right:15px; font-size:1.5em; font-weight:bold; cursor:pointer; }
    .modal-content-custom label { display:block; margin-bottom:10px; font-weight:bold; }
    .modal-content-custom input[type="number"] { padding:10px; width:80%; border:1px solid gold; border-radius:5px; margin-bottom:20px; background:#000; color:gold; }
    .modal-content-custom select { padding:10px; width:85%; border:1px solid gold; border-radius:5px; margin-bottom:20px; background:#000; color:gold; font-weight:bold; }
    .modal-content-custom button[type="submit"], .modal-content-custom button.cancel { background:gold; color:#000; border:none; padding:10px 20px; border-radius:5px; font-weight:bold; cursor:pointer; transition:background .3s; margin:0 5px; }
    .modal-content-custom button[type="submit"]:hover, .modal-content-custom button.cancel:hover { background:#c0a000; }
    footer { padding:20px; background:rgba(0,0,0,.8); border-top:2px solid gold; text-align:center; color:gold; }
    footer a { color: gold; text-decoration: none; }
    footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header class="hero-header">
    <h1>–ú–∞–≥–∞–∑–∏–Ω IBITIcoin</h1>
    <p>–ü—Ä–∏–æ–±—Ä–µ—Ç–∞–π—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å IBITIcoin!</p>
  </header>

  <div id="countdownNotice"></div>

  <section class="wallet-section">
    <button id="openWalletModal">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
    <div id="walletAddress"></div>
    <div id="ibitiBalance"></div>
  </section>

  <button type="button" onclick="openAddTokenModal()"
          style="margin-top:10px;background:#0f172a;color:#d1fae5;border:1px solid #10b981;padding:10px 16px;border-radius:10px;cursor:pointer;">
    –î–æ–±–∞–≤–∏—Ç—å IBITI –≤ –∫–æ—à–µ–ª—ë–∫
  </button>

  <!-- CONNECT WALLET MODAL -->
  <div id="walletModal">
    <div class="ibiti-card">
      <button type="button" id="closeWalletModal" class="ibiti-close">‚úï</button>
      <h3 style="margin:0 0 10px;font-size:18px;">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫</h3>
      <div style="display:flex;flex-direction:column;gap:10px">
        <button id="btnInjected"
                style="padding:10px 14px;border:1px solid #10b981;border-radius:8px;background:#052e2b;color:#d1fae5;cursor:pointer;">
          MetaMask / Trust Wallet
        </button>
        <button id="btnCoinbase"
                style="padding:10px 14px;border:1px solid #3f3f46;border-radius:8px;background:#111827;color:#e5e7eb;cursor:pointer;">
          Coinbase Wallet
        </button>
      </div>
    </div>
  </div>

  <section class="shop-items">
    <div class="shop-item">
      <img src="img/IBITIcoin.webp" alt="IBITIcoin">
      <h3>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ 1 (IBITIcoin)</h3>
      <p>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, —Ü–µ–Ω–∞ –∏ —É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏/–æ–ø–ª–∞—Ç—ã.</p>
      <button class="buy-button" onclick="openPurchaseModal('IBITIcoin')">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="shop-item">
      <img src="img/NFT.webp" alt="NFT">
      <h3>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ 2 (NFT)</h3>
      <p>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, —Ü–µ–Ω–∞ –∏ —É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏/–æ–ø–ª–∞—Ç—ã.</p>
      <button class="buy-button" onclick="openPurchaseModal('NFT')">–ö—É–ø–∏—Ç—å</button>
    </div>
  </section>

  <div id="purchaseModal" class="modal">
    <div class="modal-content-custom">
      <span class="close" onclick="closePurchaseModal()">&times;</span>
      <h2 id="purchaseTitle">–ü–æ–∫—É–ø–∫–∞</h2>
      <form id="purchaseForm">
        <label for="nftAmount">–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
        <input type="number" id="nftAmount" name="nftAmount" min="1" required>
        <label for="paymentToken">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</label>
        <select id="paymentToken" required>
          <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
          <option value="USDT">USDT</option>
        </select>
        <br><br>
        <button type="submit" id="confirmBtn" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É</button>
        <button type="button" class="cancel" onclick="closePurchaseModal()">–û—Ç–º–µ–Ω–∞</button>
      </form>
    </div>
  </div>

  <!-- SALE STATS -->
  <section id="saleStats" data-aos="fade-up" style="margin:40px auto; max-width:800px; padding:24px; background:#111; color:#fff; border:1px solid gold; border-radius:10px; text-align:center; box-shadow:0 0 20px rgba(255,215,0,.1); transition:transform .3s ease, box-shadow .3s ease;" onmouseover="this.style.transform='scale(1.015)'; this.style.boxShadow='0 0 25px rgba(255, 215, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 20px rgba(255, 215, 0, 0.1)'">
    <div class="progress-container">
      <div id="salesProgress" class="progress-bar"></div>
    </div>
    <div style="font-size:.9em; color:#aaa;">–ü—Ä–æ–¥–∞–Ω–æ: <span id="soldPercent">0%</span></div>
    <h3 style="color: gold; font-size: 1.8em; margin-bottom: 16px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω—Å–µ–π–ª–∞</h3>
    <ul style="list-style:none; padding-left:0; color:gold; font-size:1.1em;">
      <li>üîπ –í—Å–µ–≥–æ –Ω–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ:   <strong><span id="cap">‚Äî</span></strong> IBI</li>
      <li>üîπ –†–µ–∑–µ—Ä–≤ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:      <strong><span id="refReserve">‚Äî</span></strong> IBI</li>
      <li>üîπ –û—Å–Ω–æ–≤–Ω–æ–π –ø—É–ª –ø—Ä–æ–¥–∞–∂:   <strong><span id="salePool">‚Äî</span></strong> IBI</li>
      <li>üîπ –ü—Ä–æ–¥–∞–Ω–æ:               <strong><span id="sold">‚Äî</span></strong> IBI</li>
      <li>üîπ –û—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–¥–∞–∂:       <strong><span id="left">‚Äî</span></strong> IBI</li>
      <li>üîπ –ü—É–ª –±–æ–Ω—É—Å–æ–≤ (10%):     <strong><span id="bonusPool">‚Äî</span></strong> IBI</li>
    </ul>
    <div style="margin-top:16px; font-size:.9em; color:#aaa;">
      <span id="lastUpdated">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ‚Äî</span>
      <button id="refreshStats" style="margin-left:12px; background:gold; color:#000; border:none; padding:4px 8px; border-radius:4px; cursor:pointer;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
  </section>

  <section id="referralInfo" data-aos="fade-up" style="margin:40px auto; max-width:800px; padding:24px; background:#111; color:#fff; border:1px solid gold; border-radius:10px; text-align:center; box-shadow:0 0 20px rgba(255,215,0,.1); transition:transform .3s ease, box-shadow .3s ease;" onmouseover="this.style.transform='scale(1.015)'; this.style.boxShadow='0 0 25px rgba(255, 215, 0, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 20px rgba(255, 215, 0, 0.1)'">
    <h3 style="color: gold; font-size: 1.8em; margin-bottom: 16px;">üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
    <p style="margin: 8px 0;">üî∏ –ö—É–ø–∏—Ç–µ <strong>–æ—Ç 10 IBITI</strong> ‚Äî –∏ –ø–æ–ª—É—á–∏—Ç–µ <strong>1 IBITI –±–æ–Ω—É—Å–æ–º</strong> —Å—Ä–∞–∑—É.</p>
    <p style="margin: 8px 0;">üî∏ –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π.</p>
    <p style="margin: 8px 0;">üî∏ –î–µ–ª–∏—Ç–µ—Å—å –µ—é ‚Äî –∏ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞, –∫–æ—Ç–æ—Ä—ã–π –∫—É–ø–∏—Ç —Ç–æ–∫–µ–Ω—ã, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –µ—â—ë <strong>+1 IBITI</strong>.</p>
    <p style="margin-top: 16px;">üìå –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –Ω–µ –Ω—É–∂–Ω–æ.</p>
  </section>

  <div style="margin:32px auto 64px; text-align:center;">
    <input type="text" id="myReferralLink" readonly
      placeholder="–°—Å—ã–ª–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏ –æ—Ç 10 IBITI"
      style="width:100%; max-width:500px; padding:10px; border:1px solid gold; border-radius:6px; background:#000; color:gold; font-weight:bold; margin-bottom:12px;" />
    <br />
    <button id="copyMyReferralLink" class="btn-small" style="padding:10px 24px; font-weight:bold;">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–æ—é —Å—Å—ã–ª–∫—É</button>
    <button id="openShareModal" style="margin-top:12px; margin-left:8px; padding:10px 24px; font-weight:bold; background:gold; color:#000; border:none; border-radius:6px; cursor:pointer;">üì£ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π</button>

    <div id="referralStats" style="display:none">üë• –ü—Ä–∏–≤–µ–¥–µ–Ω–æ –¥—Ä—É–∑–µ–π: <span id="refCount">0</span><br>üí∞ –ü–æ–ª—É—á–µ–Ω–æ –±–æ–Ω—É—Å–æ–≤: <span id="refReward">0</span> IBITI</div>
  </div>

  <div id="shareModal" class="modal" style="display:none; position:fixed; z-index:3000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,.8); justify-content:center; align-items:center;">
    <div class="modal-content-custom" style="max-width:500px; margin:auto;">
      <span id="closeShareModal" style="position:absolute; top:10px; right:15px; font-size:1.5em; font-weight:bold; cursor:pointer;">&times;</span>
      <h3 style="margin-bottom:20px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ü—Å–µ—Ç—å –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞</h3>
      <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;">
        <a id="share-facebook" target="_blank" class="btn-small">Facebook</a>
        <a id="share-twitter" target="_blank" class="btn-small">Twitter</a>
        <a id="share-vk" target="_blank" class="btn-small">VK</a>
        <a id="share-telegram" target="_blank" class="btn-small">Telegram</a>
        <a id="share-ok" target="_blank" class="btn-small">–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏</a>
        <a id="share-linkedin" target="_blank" class="btn-small">LinkedIn</a>
        <a id="share-weibo" target="_blank" class="btn-small">Weibo</a>
      </div>
    </div>
  </div>

  <div id="toast" style="position:fixed; bottom:30px; right:30px; background:#111; color:gold; border:1px solid gold; border-radius:8px; padding:12px 20px; font-weight:bold; box-shadow:0 0 10px rgba(255,215,0,.3); opacity:0; pointer-events:none; z-index:9999; transition:opacity .3s ease;">‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä</div>

  <footer>
    <p>&copy; 2025 IBITIcoin. All rights reserved.</p>
    <p><a href="index.html">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a></p>
  </footer>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.5/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2/dist/umd/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@coinbase/wallet-sdk@4.3.3/dist/CoinbaseWalletSDK.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <script> AOS.init({ once: true }); </script>

  <!-- modules -->
  <script type="module" src="js/config.js"></script>
  <script type="module" src="js/sale.js"></script>
  <script type="module" src="js/wallet.js"></script>
  <script type="module" src="js/shop.js"></script>

  <script type="module">
    import Swal from "https://cdn.jsdelivr.net/npm/sweetalert2@11/+esm";
    document.addEventListener("DOMContentLoaded", () => {
      const linkInput = document.getElementById("myReferralLink");
      const copyBtn   = document.getElementById("copyMyReferralLink");
      const toast     = document.getElementById("toast");
      const shareModal= document.getElementById("shareModal");
      const openBtn   = document.getElementById("openShareModal");
      const closeBtn  = document.getElementById("closeShareModal");
      const pageTitle = encodeURIComponent(document.title);

      copyBtn.addEventListener("click", () => {
        Swal.fire({ icon:"info", title:"–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ", text:"–°–Ω–∞—á–∞–ª–∞ –∫—É–ø–∏—Ç–µ –æ—Ç 10 IBITI, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É." });
      });

      window.enableReferralAfterPurchase = async function(account) {
        const refLink = `${window.location.origin}${window.location.pathname}?ref=${account}`;
        linkInput.value = refLink;
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(refLink).then(() => {
            toast.style.opacity = "1";
            setTimeout(() => toast.style.opacity = "0", 2500);
          });
        };
        document.getElementById('share-facebook').href  = `https://www.facebook.com/sharer/sharer.php?u=${refLink}`;
        document.getElementById('share-twitter').href   = `https://twitter.com/intent/tweet?url=${refLink}&text=${pageTitle}`;
        document.getElementById('share-vk').href        = `https://vk.com/share.php?url=${refLink}&title=${pageTitle}`;
        document.getElementById('share-telegram').href  = `https://telegram.me/share/url?url=${refLink}&text=${pageTitle}`;
        document.getElementById('share-ok').href        = `https://connect.ok.ru/offer?url=${refLink}`;
        document.getElementById('share-linkedin').href  = `https://www.linkedin.com/sharing/share-offsite/?url=${refLink}`;
        document.getElementById('share-weibo').href     = `http://service.weibo.com/share/share.php?url=${refLink}&title=${pageTitle}`;
        openBtn.onclick  = () => shareModal.style.display = 'flex';
        closeBtn.onclick = () => shareModal.style.display = 'none';
        window.addEventListener('click', e => { if (e.target === shareModal) shareModal.style.display = 'none'; });
        document.getElementById("referralStats").style.display = "block";
      };
    });
  </script>

  <!-- ADD TOKEN MODAL -->
  <div id="addTokenModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:3000;align-items:center;justify-content:center;">
    <div style="background:#111;padding:18px 18px 14px;border:1px solid gold;border-radius:10px;max-width:420px;width:92%;color:#ffd700;position:relative;">
      <button onclick="closeAddTokenModal()" style="position:absolute;top:8px;right:10px;background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer;">‚úï</button>
      <h3 style="margin:0 0 10px;font-size:18px;">–ö—É–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω IBITI?</h3>
      <div style="display:flex;flex-direction:column;gap:10px">
        <button onclick="addTokenEip747()" style="padding:10px 14px;border:1px solid #10b981;border-radius:8px;background:#052e2b;color:#d1fae5;cursor:pointer;">
          MetaMask / Trust Wallet / Binance Wallet (–∞–≤—Ç–æ)
        </button>
        <details style="background:#0b0f1a;border:1px solid #333;border-radius:8px;padding:10px;">
          <summary style="cursor:pointer;color:#e5e7eb">Coinbase Wallet (—Ä—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ)</summary>
          <div style="margin-top:10px;color:#e5e7eb;font-size:14px;line-height:1.4">
            –û—Ç–∫—Ä–æ–π Coinbase Wallet ‚Üí <b>Tokens</b> ‚Üí <b>+</b> ‚Üí <b>Import Token</b> ‚Üí –≤—Å—Ç–∞–≤—å:
            <div style="margin-top:8px">
              <div>Contract: <code id="ctAddr">0xa83825e09d3bf6ABf64efc70F08AdDF81A7Ba196</code></div>
              <div>Symbol: <code>IBITI</code></div>
              <div>Decimals: <code>8</code></div>
            </div>
            <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
              <button onclick="copyText('#ctAddr')" style="padding:6px 10px;border:1px solid #3f3f46;border-radius:8px;background:#111827;color:#e5e7eb;cursor:pointer;">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button>
              <button onclick="openBscscan()" style="padding:6px 10px;border:1px solid #3f3f46;border-radius:8px;background:#111827;color:#e5e7eb;cursor:pointer;">–û—Ç–∫—Ä—ã—Ç—å –≤ BscScan</button>
            </div>
          </div>
        </details>
        <div style="font-size:12px;color:#9ca3af;margin-top:4px">
          –ï—Å–ª–∏ —É —Ç–µ–±—è –º–æ–±–∏–ª—å–Ω—ã–π Trust Wallet, –æ—Ç–∫—Ä–æ–π —Å–∞–π—Ç –≤ –∏—Ö DApp-–±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ-–¥–æ–±–∞–≤–ª–µ–Ω–∏—è.
        </div>
      </div>
    </div>
  </div>

  <script>
    const IS_MOBILE = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

    // –æ–±—â–∏–π URL —Å –º–µ—Ç–∫–æ–π –¥–µ–π—Å—Ç–≤–∏—è (?go=...)
    function buildTargetUrl(target){ const u=new URL(location.href); if(target) u.searchParams.set('go',target); return u.toString(); }

    // Deeplinks
    function openInMetaMaskDapp(target){ const full=buildTargetUrl(target); const bare=full.replace(/^https?:\/\//,''); const scheme='metamask://dapp/'+encodeURI(bare); const appLink='https://metamask.app.link/dapp/'+encodeURI(bare); try{ location.href=scheme; setTimeout(()=>location.href=appLink,600);}catch{ location.href=appLink; } }
    function openInTrustDapp(target){ const full=buildTargetUrl(target); location.href='trust://browser_enable?url='+encodeURIComponent(full); setTimeout(()=>{ location.href='https://link.trustwallet.com/open_url?url='+encodeURIComponent(full); },600); }
    function openInCoinbaseDapp(target){ const full=buildTargetUrl(target); location.href='cbwallet://dapp?url='+encodeURIComponent(full); setTimeout(()=>{ location.href='https://go.cb-w.com/dapp?cb_url='+encodeURIComponent(full); },600); }

    const IBITI_TOKEN = { address:'0xa83825e09d3bf6ABf64efc70F08AdDF81A7Ba196', symbol:'IBITI', decimals:8, image:'https://ibiticoin.com/img/IBITI-512.png' };

    function openAddTokenModal(){ const m=document.getElementById('addTokenModal'); m.style.display='flex'; m.onclick=e=>{ if(e.target===m) closeAddTokenModal(); }; }
    function closeAddTokenModal(){ document.getElementById('addTokenModal').style.display='none'; }

    function openInstallMM(){ const m=document.getElementById('installMM'); m.style.display='flex'; m.onclick=e=>{ if(e.target===m) closeInstallMM(); }; }
    function closeInstallMM(){ document.getElementById('installMM').style.display='none'; }

    function toast(msg){ const el=document.getElementById('toastOK'); el.textContent=msg; el.style.opacity='1'; clearTimeout(el._timer); el._timer=setTimeout(()=> el.style.opacity='0',2600); }

    function hasEthereum(){ return !!(window.ethereum && typeof window.ethereum.request==='function'); }

    async function addTokenEip747(){
      if (IS_MOBILE && !hasEthereum()) { openInMetaMaskDapp('addToken'); return; }
      if (!hasEthereum()) { openInstallMM(); return; }
      try{
        const bscId='0x38';
        const current=await window.ethereum.request({method:'eth_chainId'});
        if(current!==bscId){
          try{ await window.ethereum.request({method:'wallet_switchEthereumChain', params:[{chainId:bscId}]}); }
          catch(e){
            if(e.code===4902){
              await window.ethereum.request({ method:'wallet_addEthereumChain', params:[{ chainId:bscId, chainName:'BNB Smart Chain', nativeCurrency:{name:'BNB',symbol:'BNB',decimals:18}, rpcUrls:['https://bsc-dataseed1.bnbchain.org'], blockExplorerUrls:['https://bscscan.com'] }] });
            } else { throw e; }
          }
        }
        const added=await window.ethereum.request({ method:'wallet_watchAsset', params:{ type:'ERC20', options:IBITI_TOKEN } });
        if(added){ toast('‚úÖ IBITI –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—à–µ–ª—ë–∫'); closeAddTokenModal(); } else { toast('‚ÑπÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ'); }
      }catch(err){
        if(err && err.code===4001){ toast('‚ÑπÔ∏è –î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º'); }
        else { console.error('Add IBITI error:', err); alert('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ—à–µ–ª—ë–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.'); }
      }
    }

    function copyText(sel){ const t=document.querySelector(sel).textContent.trim(); navigator.clipboard.writeText(t).then(()=>toast('‚úÖ –ê–¥—Ä–µ—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω')); }
    function openBscscan(){ window.open('https://bscscan.com/token/'+IBITI_TOKEN.address,'_blank'); }
  </script>

  <div id="toastOK" style="position:fixed;right:20px;bottom:24px;background:#0b0f1a;border:1px solid #10b981;color:#d1fae5;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .25s;z-index:4000"></div>

  <div id="installMM" style="display:none;position:fixed;inset:0;z-index:4000;background:rgba(0,0,0,.6);align-items:center;justify-content:center">
    <div style="background:#111;border:1px solid gold;border-radius:10px;padding:18px;max-width:420px;width:92%;color:#ffd700;position:relative">
      <button onclick="closeInstallMM()" style="position:absolute;top:8px;right:10px;background:transparent;border:0;color:#fff;font-size:18px;cursor:pointer">‚úï</button>
      <h3 style="margin:0 0 10px">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask</h3>
      <p style="color:#e5e7eb;margin:0 0 12px">–ß—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω, –Ω—É–∂–µ–Ω –∫–æ—à–µ–ª—ë–∫ MetaMask (–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π).</p>
      <a href="https://metamask.io/download/" target="_blank" rel="noopener" style="display:inline-block;padding:10px 14px;border:1px solid #10b981;border-radius:8px;background:#052e2b;color:#d1fae5;text-decoration:none">–°–∫–∞—á–∞—Ç—å MetaMask</a>
    </div>
  </div>

  <script>
    // Mobile UX: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—à—É –º–æ–¥–∞–ª–∫—É –≤–º–µ—Å—Ç–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —É—Ö–æ–¥–∞ –≤ MetaMask
    document.getElementById('openWalletModal')?.addEventListener('click', (e) => {
      if (IS_MOBILE && !(window.ethereum && window.ethereum.request)) {
        e.preventDefault();
        document.getElementById('walletModal').style.display='flex';
        return;
      }
      // –µ—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –µ—Å—Ç—å ‚Äî –¥–∞–ª—å—à–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–≥–∏–∫–∞ wallet.js
    });
    document.getElementById('closeWalletModal')?.addEventListener('click', () => {
      document.getElementById('walletModal').style.display='none';
    });

    // –ö–Ω–æ–ø–∫–∞ MetaMask / Trust ‚Äî —è–≤–Ω—ã–π –≤—ã–±–æ—Ä
    document.getElementById('btnInjected')?.addEventListener('click', async (e) => {
      if (IS_MOBILE && !(window.ethereum && window.ethereum.request)) {
        e.preventDefault();
        const res = await Swal.fire({
          title: '–û—Ç–∫—Ä—ã—Ç—å –≤‚Ä¶',
          showDenyButton: true,
          confirmButtonText: 'MetaMask',
          denyButtonText: 'Trust Wallet',
          confirmButtonColor: '#f6851b',
          denyButtonColor: '#3375bb',
          background: '#111',
          color: '#ffd700'
        });
        if (res.isConfirmed) openInMetaMaskDapp('connect');
        else if (res.isDenied) openInTrustDapp('connect');
        return;
      }
    });

    // –ö–Ω–æ–ø–∫–∞ Coinbase ‚Äî deeplink –≤ Coinbase Wallet
    document.getElementById('btnCoinbase')?.addEventListener('click', (e) => {
      if (IS_MOBILE && !(window.ethereum && window.ethereum.request)) {
        e.preventDefault();
        openInCoinbaseDapp('connect');
        return;
      }
    });

    // –ü–∞—Ç—á –Ω–∞ eth_requestAccounts: –±–µ–∑ –¥—É–±–ª–µ–π –∏ –±–µ–∑ -32002 –Ω–∞–≤–µ—Ä—Ö
    (function patchEthRequestAccounts() {
      const eth = window.ethereum;
      if (!eth || !eth.request) return;
      const orig = eth.request.bind(eth);
      let pendingPromise = null;

      function waitForAccounts(timeoutMs = 120000) {
        return new Promise((resolve, reject) => {
          if (eth.selectedAddress) return resolve([eth.selectedAddress]);
          const onChange = (accounts) => { cleanup(); accounts && accounts.length ? resolve(accounts) : reject(new Error('Empty accounts')); };
          const timer = setTimeout(() => { cleanup(); reject(new Error('accountsChanged timeout')); }, timeoutMs);
          function cleanup(){ clearTimeout(timer); eth.removeListener?.('accountsChanged', onChange); }
          eth.on?.('accountsChanged', onChange);
        });
      }

      eth.request = async (args) => {
        if (!args || args.method !== 'eth_requestAccounts') return orig(args);
        if (pendingPromise) return pendingPromise;
        pendingPromise = (async () => {
          try { return await orig(args); }
          catch (e) {
            const already = e && (e.code === -32002 || /Already processing/i.test(e.message||''));
            if (already) { try{ console.log('[wallet] Waiting for MetaMask approval‚Ä¶'); }catch{}; return await waitForAccounts(); }
            throw e;
          } finally { pendingPromise = null; }
        })();
        return pendingPromise;
      };
    })();

    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–∏ dApp-–±—Ä–∞—É–∑–µ—Ä–∞
    (function autoRunInsideWallet(){
      const p = new URLSearchParams(location.search).get('go');
      if (!p) return;
      const run = () => {
        if (p === 'connect' && window.ethereum) window.ethereum.request({ method:'eth_requestAccounts' }).catch(()=>{});
        if (p === 'addToken' && typeof window.addTokenEip747 === 'function') window.addTokenEip747();
      };
      setTimeout(run, 1000);
      setTimeout(() => {
        try { Swal.fire({ title:'–ù—É–∂–µ–Ω —Ç–∞–ø', text:'–ù–∞–∂–º–∏—Ç–µ ¬´–ü–æ–¥–∫–ª—é—á–∏—Ç—å¬ª –∏–ª–∏ ¬´–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω¬ª –µ—â—ë —Ä–∞–∑ –≤–Ω—É—Ç—Ä–∏ –∫–æ—à–µ–ª—å–∫–∞.', icon:'info', confirmButtonText:'–û–∫', background:'#111', color:'#ffd700' }); } catch {}
      }, 3000);
    })();
  </script>
</body>
</html>
